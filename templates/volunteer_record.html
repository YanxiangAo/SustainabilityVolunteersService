<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Hours Record - Sustainable Volunteer Platform</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-theme.css') }}">
</head>

<body>
    <!-- Header: back to participant dashboard + export-all button -->
    <header class="header">
        <div class="container header-content">
            <a href="/participant/dashboard" class="btn btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                    <line x1="19" y1="12" x2="5" y2="12" />
                    <polyline points="12 19 5 12 12 5" />
                </svg>
                Back to Dashboard
            </a>
            <button id="export-all-btn" class="btn btn-outline">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                Export Records
            </button>
        </div>
    </header>

    <div class="container py-8">
        <!-- Page Title + intro copy -->
        <div class="mb-8">
            <h1>Volunteer Hours Record</h1>
            <p class="text-gray-600">View all your volunteer service records and points</p>
        </div>

        <!-- Stats Cards: total hours / points / completed projects -->
        <div class="grid grid-cols-3 mb-8">
            <div class="card">
                <div class="card-content">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Total Hours</p>
                            <p class="stat-number-lg stat-number-green">{{ "%.1f"|format(total_hours) }}h
                            </p>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="color: var(--primary-green); opacity: 0.2;">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Total Points</p>
                            <p class="stat-number-lg stat-number-blue">{{ total_points }}</p>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="color: var(--secondary-blue); opacity: 0.2;">
                            <circle cx="12" cy="8" r="7" />
                            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Completed Projects</p>
                            <p class="stat-number-lg stat-number-purple">{{ completed_count }}</p>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="color: var(--accent-purple); opacity: 0.2;">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters: year + category dropdowns (wired to static/js/volunteer_record.js) -->
        <div class="card mb-6">
            <div class="card-content">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="color: var(--gray-500);">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                        </svg>
                        <span class="text-sm text-gray-600">Filter:</span>
                    </div>
                    <select id="year-filter" class="form-select">
                        <option value="">All Years</option>
                        {% for year in available_years %}
                        <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                    <select id="category-filter" class="form-select">
                        <option value="">All Categories</option>
                        {% for category in available_categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                    <button class="btn btn-ghost btn-sm" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>
        </div>

        <!-- Records Table: per-project certified hour records -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin: 0;">Record Details</h3>
            </div>
            <div class="card-content">
                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Category</th>
                            <th>Organization</th>
                            <th>Date</th>
                            <th>Certified Hours</th>
                            <th>Points Earned</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="records-tbody">
                        {% if records_data %}
                        {% for item in records_data %}
                        {% set record = item.record %}
                        {% set project = item.project %}
                        {% set organization = item.organization %}
                        <tr>
                            <td>
                                {% if project and project.id %}
                                <a href="/project/{{ project.id }}" style="color: inherit; text-decoration: none;">{{
                                    project.title }}</a>
                                {% else %}
                                Unknown Project
                                {% endif %}
                            </td>
                            <td>
                                {% if project and project.category %}
                                {% if project.category == 'Environmental' %}
                                <span class="badge badge-primary">Environmental</span>
                                {% elif project.category == 'Education' %}
                                <span class="badge badge-blue">Education</span>
                                {% elif project.category == 'Care' %}
                                <span class="badge" style="background-color: #fce7f3; color: #831843;">Care</span>
                                {% else %}
                                <span class="badge badge-secondary">{{ project.category }}</span>
                                {% endif %}
                                {% else %}
                                <span class="badge badge-secondary">N/A</span>
                                {% endif %}
                            </td>
                            <td class="text-sm text-gray-600">
                                {% if organization %}
                                {{ organization.display_name or organization.username }}
                                {% else %}
                                Unknown Organization
                                {% endif %}
                            </td>
                            <td>
                                {% if record.completed_at %}
                                {{ record.completed_at }}
                                {% else %}
                                N/A
                                {% endif %}
                            </td>
                            <td>
                                <div class="flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2"
                                        style="color: var(--gray-500);">
                                        <circle cx="12" cy="12" r="10" />
                                        <polyline points="12 6 12 12 16 14" />
                                    </svg>
                                    <span>{{ "%.1f"|format(record.hours) }}h</span>
                                </div>
                            </td>
                            <td>
                                <div class="flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2"
                                        style="color: var(--secondary-blue);">
                                        <circle cx="12" cy="8" r="7" />
                                        <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" />
                                    </svg>
                                    <span style="color: var(--secondary-blue);">{{ record.points }}</span>
                                </div>
                            </td>
                            <td>
                                {% if record.status == 'approved' %}
                                <span class="badge badge-success">Certified</span>
                                {% elif record.status == 'pending' %}
                                <span class="badge badge-orange">Pending</span>
                                {% else %}
                                <span class="badge badge-secondary">{{ record.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-center text-gray-500 py-8">No volunteer records found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Summary: footer text + export-current-results button -->
        <div class="card mt-6">
            <div class="card-content">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">
                            Showing {{ records_data|length }} record{{ 's' if records_data|length != 1 else '' }},
                            totaling {{ "%.1f"|format(total_hours) }} hours and {{ total_points }} points
                        </p>
                        <p class="text-xs text-gray-500 mt-1">
                            {% if completed_count > 0 %}
                            You have completed {{ completed_count }} volunteer project{{ 's' if completed_count != 1
                            else '' }}. Keep up the great work!
                            {% else %}
                            Start volunteering to earn hours and points!
                            {% endif %}
                        </p>
                    </div>
                    <button id="export-filtered-btn" class="btn btn-outline">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export Current Results
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="volunteer-records-container" data-records-data="{{ records_data|tojson|safe }}" style="display: none;"></div>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/volunteer_record.js') }}"></script>
</body>

</html>